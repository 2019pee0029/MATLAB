function gf=gradmaxdiag(x,varargin)
% Maximizaton of the diagonality of hte matrix. 
covmat = varargin{1};   % #pix X #pix X #taus 
sizevec = varargin{2};
W = reshape(x, sizevec(1)*sizevec(2), sizevec(3));
ntau = size(covmat,3); % #taus (different time delays)
gftmp = zeros(ntau,sizevec(1)*sizevec(2));
for tau=1:ntau
    covmattmp = covmat(:,:,tau);
    Q = diag(inv(W'*covmattmp*W));
    gftmp(tau,:) = Q'*W'*covmattmp;
end

gf = re(gftmp);